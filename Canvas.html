<!DOCTYPE html>
<html>
<head>
<!-- Canvas.html -->
<title>Canvas</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script type='text/javascript' src='/js/all_values.js'></script>

 
<style>
.container {
	width: 1250px;
	height: 500px;
}

.canvas_css {
	width: 850px;
	float: left;
}

.chat_css {
	width: 380px;
	height: 430px;
	float: left;
}

.chatContent {
	    height: 400px;
	padding: 1px 40px 0px 0px;
	background: #3596c5;
}

.insert_css {
	width: 370px;
	border: 1px black;
	background-color: #00BCD4;
	padding: 1px 1px 5px 10px;
}
</style>
<script>
	$(document).ready(function() {

		//참여자 목록을 보여주는 리스트 숨김
		$('#p_list').hide();
		//보이기 버튼을 클릭 했을 시에 참여자 목록을 보여주거나 숨겨준다.
		$('#divView').click(function() {
			var state = $('#p_list').css('display');
			//숨겨진 상태
			if(state == 'none')
			{
				//0.5초 의 지연으로 보여짐.
				$('#p_list').show(500);
				
			}
			//보여지는 상태
			else
			{
				//0.5초의 지연으로 사라짐
				$('#p_list').hide(500);
			}
			
		});
		
		
		
		
		// /temp?id=""&room="" 정보를 받아와서 ejs특수태그를 이용해 받아옴.
		var id = '<%= userid %>';
		//채팅자 이름에 집어넣음
        document.getElementById("chatName").value = id;
        
		//룸 이름에 집어넣음
        var roomname = '<%= room %>';
        document.getElementById("room").value = roomname;
		

		var socket = io.connect(); // 소켓 이벤트를 연결

		
		
		
		/**
			참여자 목록 영역
		*/
		var participant = [];
		
		var check;
		
		//참여자 목록을 서버에 요청함
		socket.emit('participant');
		
		
		socket.on('completepj', function() {
			alert('압축완성');
			
			socket.emit('deletefile');
			window.location = '/download/';
			
		});
		
		
		//참여자 목록을 받아옴
 	 	socket.on('participant', function(data) {
			//참여자 목록을 저장시킨 후
 	 		participant = data;
			//참여자목록 div에 뿌려줌
			$('#participant').text(participant.toString());
		});    
		
		//참여자가 룸을 나갈 시
 	 	socket.on('exitclient', function(data) {			
 	 		//참여자 목록 배열을 새로 받아서 넣어줌
 	 		participant = data;
			$('#participant').text(participant.toString());
		});
		

		/**
			채팅 영역
		*/
		socket.on('chatMessage', function(data) {
			
			//자신의 이름 체크
			var me = $('#chatName').val();
			if(me === data.name)
			{
				//이름이 같을 때는 오른쪽에 메세지가 뜨게 한다.
				var output = '';
				output += '<div align="right"><p align="left" style="background:yellow; width:200px">' + data.name + '님의 말:';
				output += '		' + data.message + '</p></div>';
			}
			else
			{
				//이름이 다를 경우 메세지가 오른쪽에 뜨게 한다.
				var output = '';
				output += '<div align="left" style="padding-left:10px"><p align="left" style="background:white; width:200px">' + data.name + '님의 말:';
				output += '		' + data.message + '</p></div>';
			}
			//내용 추가
			$(output).appendTo('#chatContent');	
			//스크롤이 내려가도 가장 마지막 값이 뷰에 보이게 해준다.
			$('.chatContent').scrollTop($('.chatContent')[0].scrollHeight);
		});

		 
		 //엔터키 입력 시
		$('#chatMessage').keydown(function(event) {
			if(event.which === 13)
			{
				var checkEmpty = $('#chatMessage').val();
				//아무것도 입력하지 않았을 경우에는 메세지가 입력되지 않는다.
				if(checkEmpty!= "")
				{	
					//이름이랑 메시지 보냄
					socket.emit('chatMessage', {
					name : $('#chatName').val(),
					message : $('#chatMessage').val()
					});
					//채팅창에 입력한 내용 없앰.
					$('#chatMessage').val("");
				}				
			}
				
		});
			
		


	//메일 삭제 영역 입력하기
	$(document).on("click", ".del", function() {
		$(this).parent().remove();
		mailListValue--;

	});
		
	
	
	//메일 추가 영역
	$('#addmail').click(function() {
		var mailListDiv = $('#maillist').val();

		var output ='';
		output += '<div>';
		//name을 모두 mail로 지정시킨다.
		output += '<input type="text" name="mail"/>';
		output += '<input type="button" value="삭제" class="del" name="del"/>';
		output += '<br/>';
		output += '</div>';
		
		
		$(output).appendTo('#maillist');
		mailListValue++;
		
	});
		

		 //메일 보내기 영역
		$('#sendmail').click(function() {
			
			var sendList = [];
		 	for(var i = 0; i < mailListValue; i++)
			{
		 		//추가시킨 메일 의 name을 모두 mail로 만들어서 추가된 메일칸의  모든 요소를 저장시킨다.
		 		var mail = $("#maillist input[name='mail']").eq(i).val();
		 		
		 		//저장된 메일을 배열에 추가시킨다.
		 		sendList[i] = mail;
			} 
		 	//서버에 룸 정보와 보낼 메일 리스트를 보낸다.
		 	socket.emit('sendEmail', {
				room: roomname,
				mail: sendList});
		});
	
		
		//메일 추가를 위한 변수 지정
		var mailListValue = 0;


		//버튼 클릭 시
		$('#chatButton').click(function() {
			var checkEmpty = $('#chatMessage').val();
			if(checkEmpty!= "")
			{	
			
			socket.emit('chatMessage', {
				name : $('#chatName').val(),
				message : $('#chatMessage').val()
			});
			$('#chatMessage').val("");
			}
		});

	

	});
</script>



</head>
<body>
	
	<div class="row">
	<div class="col-md-2">
		<br/>
		<br/>
		<button type ="button" class="btn btn-primary" id="crea_mvc"> MVC 구조 그리기 </button>
		<br/>
		<br/>
		Controller
		<button type ="button" class="btn btn-success" id="crea_controller"> + </button>
		<br/>
		<div id = "conlist">
		
		</div>
		<br/>
		Service
		<button type ="button" class="btn btn-warning" id="crea_service"> + </button>
		<br/>
		<div id = "serlist">
		
		</div>
		<br/>
		DAO
		<button type ="button" class="btn btn-danger" id="crea_dao"> + </button>
		<br/>
		<div id = "daolist">
		
		</div>
	</div>
	<div class="col-md-7">
		<canvas id="canvas1" height="900" width="1600">This browser doesn't support canvas</canvas>
		
		<!-- Modal -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" id="myModalLabel">Modal title</h4>
					</div>
					<div class="modal-body">
					<!-- modal의 body 여기안에 input box들을 넣음. -->
					
					Class Name : <input type="text" id="classname" />
					<div id="valueDiv">
						<br />
						<input type="Button" value="Value추가" onclick="AddValueForm()"> 
						<input type="Button" value="Value삭제" onclick="DelValueForm()"> <br />
						Value0 : <input type="text" id="valuename0" />
						<select id="select_value0">
							<option value = "init">선택하세요</option>
							<option value="int">int</option>
							<option value="String">String</option>
						</select> <br />
					</div>
					<br />
					<div id="methodDiv">
						<input type="Button" value="Method추가" onclick="AddMethodForm()">
						<input type="Button" value="Method삭제" onclick="DelMethodForm()">
						<br /> Method0 : <input type="text" id="methodname0" />
						<select id="select_method0">
							<option value ="init">선택하세요</option>
							<option value="void">void</option>
							<option value="int">int</option>
							<option value="String">String</option>
						</select> <br />
					</div>
					<br /> 
					Connet Class : 
					<select id="connectclass"> 
						<option value ="init">--선택하세요--</option>
					</select><br />
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" onclick="OnOK()" data-dismiss="modal">Save</button>
						<button type="button" class="btn btn-default" onclick="OnCancel()" data-dismiss="modal">Close</button>
					</div>
				</div>				
			</div>
		</div>
	</div>
	
	
	
	
	
</div>
<button>파일 생성</button>

  <script>
        var canvas = document.getElementById('canvas1');     // Canvas 객체 추출

        var context = canvas.getContext('2d');

    function Point(event, target) {     // Point 생성자 함수 선언

         this.x = event.pageX - $(target).position().left- document.body.scrollWidth/6;
    
// 파폭은 offsetX 속성을 지원하지 않으므로 이런 방식의 코드를 사용함
// list를 위한 div를 만들면 그만큼 x좌표가 밀려서 출력되기 때문에 div의 크기만큼 뺴줌.

        this.y = event.pageY - $(target).position().top;

    }

    </script>


  <script>



        var socket = io.connect();      // 소켓 이벤트를 연결

        socket.emit('join', '<%= room %>');     // ejs 모듈 특수 태그 사용. http://localhost:8210/canvas/21 접속시 문자열 21 전송




		//mvc_modal.js
//리스트에서 클릭한 거 check_package에 넣어주기
		$("#crea_controller").click(function(){
			list_click = true;
			check_package = "Controller";
		});
		$("#crea_service").click(function(){
			list_click = true;
			check_package = "Service";
		});
		$("#crea_dao").click(function(){
			list_click = true;
			check_package = "DAO";
		});
		$("#crea_mvc").click(function(){
			list_click = true;
			check_package = "mvc";
		});

        





		//dinamic_form.js

/**
 * value form을 하나하나 증가시켜주는 함수
 */
function AddValueForm() {
	var addedValFormDiv = document.getElementById("valueDiv");
	var str = "Value";
	str += val_count + ":" + "<input type='text' id='valuename" + val_count + "'><select id = 'select_value"+ select_valcnt +"'> <option value='init'>선택하세요</option>"
						+ "<option value='int'>int</option> <option value='String'>String</option></select>";
	// 추가할 폼(에 들어갈 HTML)
	var addedValDiv = document.createElement("div"); // 폼 생성
	addedValDiv.id = "added_value" + val_count; // 폼 Div에 ID 부여 (삭제를 위해)
	addedValDiv.innerHTML = str; // 폼 Div안에 HTML삽입
	addedValFormDiv.appendChild(addedValDiv); // 삽입할 DIV에 생성한 폼 삽입
	val_count++;
	select_valcnt++;
}

/**
 * value form을 하나 감소시켜주는 함수
 */
function DelValueForm() {
	var addedValFormDiv = document.getElementById("valueDiv");
	
	if (val_count > 1) { // 현재 폼이 두개 이상이면
		var addedValDiv = document.getElementById("added_value" + (--val_count));
		--select_valcnt;
		// 마지막으로 생성된 폼의 ID를 통해 Div객체를 가져옴
		addedValFormDiv.removeChild(addedValDiv); // 폼 삭제 
	}
}

/**
 * value form을 하나빼고 모두 제거 하는 함수
 */
function DelValueAllForm()
{
	var addedValFormDiv = document.getElementById("valueDiv");
	while(val_count > 1)
	{
		if (val_count > 1) { // 현재 폼이 두개 이상이면
		var addedValDiv = document.getElementById("added_value" + (--val_count));
		--select_valcnt;
		// 마지막으로 생성된 폼의 ID를 통해 Div객체를 가져옴
		addedValFormDiv.removeChild(addedValDiv); // 폼 삭제 
		} 
	}
}

/**
 * method form을 하나하나 증가시켜주는 함수
 */
function AddMethodForm() {
	var addedMFormDiv = document.getElementById("methodDiv");
	var str = "Method";
	str += m_count + ":" + "<input type='text' id='methodname" + m_count + "'><select id = 'select_method"+ select_mcnt +"'> <option value='init'>선택하세요</option>"
						+ "<option value='void'>void</option> <option value='int'>int</option> <option value='String'>String</option></select>";
	// 추가할 폼(에 들어갈 HTML)
	var addedMDiv = document.createElement("div"); // 폼 생성
	addedMDiv.id = "added_method" + m_count; // 폼 Div에 ID 부여 (삭제를 위해)
	addedMDiv.innerHTML = str; // 폼 Div안에 HTML삽입
	addedMFormDiv.appendChild(addedMDiv); // 삽입할 DIV에 생성한 폼 삽입
	m_count++;
	select_mcnt++;
}

/**
 * method form을 하나하나 삭제시켜주는 함수
 */
function DelMethodForm() {
	var addedMFormDiv = document.getElementById("methodDiv");
	if (m_count > 1) { // 현재 폼이 두개 이상이면
		var addedMDiv = document.getElementById("added_method" + (--m_count));
		--select_mcnt;
		// 마지막으로 생성된 폼의 ID를 통해 Div객체를 가져옴
		addedMFormDiv.removeChild(addedMDiv); // 폼 삭제 
	}
}

/**
 * method form을 하나를 제외하고 모두 삭제시켜주는 함수
 */
function DelMethodAllForm()
{
	var addedMFormDiv = document.getElementById("methodDiv");
	while(m_count > 1)
	{
		if (m_count > 1) { // 현재 폼이 두개 이상이면
			var addedMDiv = document.getElementById("added_method" + (--m_count));
			--select_mcnt;
			// 마지막으로 생성된 폼의 ID를 통해 Div객체를 가져옴
			addedMFormDiv.removeChild(addedMDiv); // 폼 삭제 
		}
	}
}

/**
 * 동적으로 connectclass에 list를 받아와 option으로 만들어주는 code
 * modal창이 띄워지기 전에 호출해야함.
 */
function Dynamic_Connect_List(){
	
	// connectclass의 form을 초기화함.
	$('#connectclass').empty();
	$('<option value="init">--선택하세요--</option>').appendTo('#connectclass');
	
	if(check_package == "Controller"){
		
		for(var i=0; i<serviceList.length; i++){
			$('<option value="'+ serviceList[i].classname +'">' + serviceList[i].classname + '</option>').appendTo('#connectclass');
		}
		
		for(var i=0; i<daoList.length; i++){
			$('<option value="'+ daoList[i].classname +'">' + daoList[i].classname + '</option>').appendTo('#connectclass');
		}
		
	}else if(check_package == "Service"){
		
		for(var i=0; i<controllerList.length; i++){
			$('<option value="'+ controllerList[i].classname +'">' + controllerList[i].classname + '</option>').appendTo('#connectclass');
		}
		
		for(var i=0; i<daoList.length; i++){
			$('<option value="'+ daoList[i].classname +'">' + daoList[i].classname + '</option>').appendTo('#connectclass');
		}
		
	}else if(check_package == "DAO"){
		
		for(var i=0; i<controllerList.length; i++){
			$('<option value="'+ controllerList[i].classname +'">' + controllerList[i].classname + '</option>').appendTo('#connectclass');
		}
		
		for(var i=0; i<serviceList.length; i++){
			$('<option value="'+ serviceList[i].classname +'">' + serviceList[i].classname + '</option>').appendTo('#connectclass');
		}
	}
}

/**
 * side에 list들을 전부 띄워주는 함수. (실행하면 list들을 삭제하고 다시 그려준다.)
 */
function MVC_List_View(){
	
	$('#conlist').empty();
	$('#serlist').empty();
	$('#daolist').empty();
	
	for(var i=0;i<controllerList.length;i++){
		$('<label value="' + controllerList[i].classname + '">' + controllerList[i].classname + '</label>').appendTo('#conlist');
		$('<button onclick="List_Modify('+"\'" + controllerList[i].classname +"\'" +')">수정</button>').appendTo('#conlist');
		$('<button onclick="List_Delete('+"\'" + controllerList[i].classname +"\'" +')">삭제</button></br>').appendTo('#conlist');
	}
	for(var i=0;i<serviceList.length;i++){
		$('<label value="' + serviceList[i].classname + '">' + serviceList[i].classname + '</label>').appendTo('#serlist');
		$('<button onclick="List_Modify('+"\'" + serviceList[i].classname +"\'" +')">수정</button>').appendTo('#serlist');
		$('<button onclick="List_Delete('+"\'" + serviceList[i].classname +"\'" +')">삭제</button></br>').appendTo('#serlist');
	}
	for(var i=0;i<daoList.length;i++){
		$('<label value="' + daoList[i].classname + '">' + daoList[i].classname + '</label>').appendTo('#daolist');
		$('<button onclick="List_Modify('+"\'" + daoList[i].classname +"\'" +')">수정</button>').appendTo('#daolist');
		$('<button onclick="List_Delete('+"\'" + daoList[i].classname +"\'" +')">삭제</button></br>').appendTo('#daolist');
	}
}

/**
 * form을 초기화 해주는 함수.
 * */
function FormInit(){
	
	// 폼의 값들을 초기화
	document.getElementById("classname").value = "";
	document.getElementById("connectclass").value = "";
	document.getElementById("valuename0").value = "";
	document.getElementById("select_value0").value = "init";
	document.getElementById("methodname0").value = "";
	document.getElementById("select_method0").value = "init";
	
	// 폼 초기화
	DelValueAllForm();
	DelMethodAllForm();
}













//draw한 canvas정보들 emit해주는 함수
function EmitCanvas(gb){
	if(gb==1){
		socket.emit('draw', {
			gb:gb,
			class:controller			
			
		});
	}else if(gb==2){
		socket.emit('draw', {
			gb:gb,
			class:service			
			
		});
	}else if(gb==3){
		socket.emit('draw', {
			gb:gb,
			class:dao			
			
		});
	}
}

//수정한 canvas정보들 emit해주는 함수
function EmitModifyCanvas(gb){
	if(gb==1){
		socket.emit('modifyCanvas', {
			gb:gb,
			m_class:modify_class,
			m_idx:modify_index,
			class:controller,
			m_conn_list:m_conn_list			
			
		});
	}else if(gb==2){
		socket.emit('modifyCanvas', {
			gb:gb,
			m_class:modify_class,
			m_idx:modify_index,
			class:service,
			m_conn_list:m_conn_list	
			
		});
	}else if(gb==3){
		socket.emit('modifyCanvas', {
			gb:gb,
			m_class:modify_class,
			m_idx:modify_index,
			class:dao,
			m_conn_list:m_conn_list				
			
		});
	}
}


//삭제한 canvas정보들 emit해주는 함수
function EmitDeleteCanvas(){
	
	socket.emit('deleteCanvas', {
			gb:gubun,
			d_class:delete_class,
			d_idx:delete_index,
			d_conn_list:d_conn_list			
			
	});
	
}






			//mvc_modal_create.js
/**
 * List들을 순회하면서 class의 name들이 곂치는지 확인하기 위한 함수.
 */
function Duplication_Check(){
	
	if(check_package == "Controller"){
		if(controllerList.length != 0){
			for(var i=0;i<controllerList.length;i++){
				if(controllerList[i].classname != document.getElementById("classname").value + "Controller"){
					c_name = document.getElementById("classname").value;
					check_name = true;
				}else{
					alert("Controller의 Name이 중복 됩니다.");
					check_name = false;
					break;
				}
			}
		}else{
			c_name = document.getElementById("classname").value;
			check_name = true;
		}
	}else if(check_package == "Service"){
		if(serviceList.length != 0){
			for(var i=0;i<serviceList.length;i++){
				if(serviceList[i].classname != document.getElementById("classname").value + "Service"){
					c_name = document.getElementById("classname").value;
					check_name = true;
				}else{
					alert("Service의 Name이 중복 됩니다.");
					check_name = false;
					break;
				}
			}
		}else{
			c_name = document.getElementById("classname").value;
			check_name = true;
		}
	}else if(check_package == "DAO"){
		if(daoList.length != 0){
			for(var i=0;i<daoList.length;i++){
				if(daoList[i].classname != document.getElementById("classname").value + "DAO"){
					c_name = document.getElementById("classname").value;
					check_name = true;
				}else{
					alert("DAO의 Name이 중복 됩니다.");
					check_name = false;
					break;
				}
			}
		}else{
			c_name = document.getElementById("classname").value;
			check_name = true;
		}
	}else if(check_package == "mvc"){
		var check_name_con;
		var check_name_ser;
		var check_name_dao;
		
		if(controllerList.length != 0){
			for(var i=0;i<controllerList.length;i++){
				if(controllerList[i].classname != document.getElementById("classname").value + "Controller"){
					c_name = document.getElementById("classname").value;
					check_name_con = true;
				}else{
					alert("Controller의 Name이 중복 됩니다.");
					check_name_con = false;
					break;
				}
			}
		}else{
			c_name = document.getElementById("classname").value;
			check_name_con = true;
		}
		
		if(serviceList.length != 0){
			for(var i=0;i<serviceList.length;i++){
				if(serviceList[i].classname != document.getElementById("classname").value + "Service"){
					c_name = document.getElementById("classname").value;
					check_name_ser = true;
				}else{
					alert("Service의 Name이 중복 됩니다.");
					check_name_ser = false;
					break;
				}
			}
		}else{
			c_name = document.getElementById("classname").value;
			check_name_ser = true;
		}
		
		if(controllerList.length != 0){
			for(var i=0;i<daoList.length;i++){
				if(daoList[i].classname != document.getElementById("classname").value + "DAO"){
					c_name = document.getElementById("classname").value;
					check_name_dao = true;
				}else{
					alert("DAO의 Name이 중복 됩니다.");
					check_name_dao = false;
					break;
				}
			}
		}else{
			c_name = document.getElementById("classname").value;
			check_name_dao = true;
		}
		
		if(check_name_con == true && check_name_ser == true && check_name_dao == true){
			check_name = true;
		}else{
			check_name = false;
		}
	}
}

/**
 * document의 input tag에 저장되어 있는 값들을 불러오는 함수.
 */
function Call_Value(){
	// 중복된 class의 이름이 없으면 document의 값을 받아와 배열에 저장
	if(check_name == true){
		for(var i=0; i<val_count; i++){
			v_name[i] = document.getElementById("valuename"+i);
			select_val[i] = document.getElementById("select_value"+i);
		}
		
		for(var i=0; i<m_count; i++){
			m_name[i] = document.getElementById("methodname"+i);
			select_func[i] = document.getElementById("select_method"+i);
		}
		
		// 각 document의 값들을 저장.
		if(check_package != "mvc"){
			draw_className = c_name;
			connectclass = document.getElementById("connectclass").value;
		}
		
		// select box의 값이 선택되면 변수명 앞에 select box의 값을 붙여줌.
		for(var j=0; j<val_count; j++){
			draw_valueName[j] = v_name[j].value;
			draw_select_val[j] = select_val[j].value;
		}
		
		// select box의 값이 선택되면 메소드명 앞에 select box의 값을 붙여줌.
		for(var j=0; j<m_count; j++){
			draw_methodName[j] = m_name[j].value;
			draw_select_func[j] = select_func[j].value;
		}
	}
}


/**
 * 연결할 class를 탐색해줌.
 */
function Connect_Class_Check(){
	if(check_package == "Controller" && connectclass != "init"){
		for(var i=0;i<serviceList.length;i++){
			if(connectclass == serviceList[i].classname){
				conn_index = i;
				conn_ser = true;
				break;
			}else{
				conn_ser = false;
			}
		}
		
		for(var i=0;i<daoList.length;i++){
			if(connectclass == daoList[i].classname){
				conn_index = i;
				conn_dao = true;
				break;
			}else{
				conn_dao = false;
			}
		}
		
	}else if(check_package == "Service" && connectclass != "init"){
		for(var i=0;i<controllerList.length;i++){
			if(connectclass == controllerList[i].classname){
				conn_index = i;
				conn_con = true;
				break;
			}else{
				conn_con = false;
			}
		}
		
		for(var i=0;i<daoList.length;i++){
			if(connectclass == daoList[i].classname){
				conn_index = i;
				conn_dao = true;
				break;
			}else{
				conn_dao = false;
			}
		}
		
	}else if(check_package == "DAO"  && connectclass != "init"){
		for(var i=0;i<controllerList.length;i++){
			if(connectclass == controllerList[i].classname){
				conn_index = i;
				conn_con = true;
				break;
			}else{
				conn_con = false;
			}
		}
		
		for(var i=0;i<serviceList.length;i++){
			if(connectclass == serviceList[i].classname){
				conn_index = i;
				conn_ser = true;
				break;
			}else{
				conn_ser = false;
			}
		}		
	}
}

/**
 * connectclass에 입력하여 연결하고자 하는 class를 찾아서 그 좌표를 가져오는 함수
 */
function Connection_Class(){
	
	Connect_Class_Check();
	
	if(conn_con == true){
		conn_point_X = controllerList[conn_index].end_point_x;
		conn_point_Y = controllerList[conn_index].end_point_y;
		
	}else if(conn_ser == true){
		conn_point_X = serviceList[conn_index].end_point_x;
		conn_point_Y = serviceList[conn_index].end_point_y;
		
	}else if(conn_dao == true){
		conn_point_X = daoList[conn_index].end_point_x;
		conn_point_Y = daoList[conn_index].end_point_y;
	}
}

function All_Draw_Connect_Line(){

	for (var i=0;i<controllerList.length;i++) {
		if (connectclass == controllerList[i].classname) {
			conn_index = i;
			conn_con = true;
			break;
		} else {
			conn_con = false;
		}
	}

	for (var i=0;i<serviceList.length;i++) {
		if (connectclass == serviceList[i].classname) {
			conn_index = i;
			conn_ser = true;
			break;
		} else {
			conn_ser = false;
		}
	}

	for (var i=0;i<daoList.length;i++) {
		if (connectclass == daoList[i].classname) {
			conn_index = i;
			conn_dao = true;
			break;
		} else {
			conn_dao = false;
		}
	}
	
	if(conn_con){
		conn_point_X = controllerList[conn_index].end_point_x;
		conn_point_Y = controllerList[conn_index].end_point_y;
	}else if(conn_ser){
		conn_point_X = serviceList[conn_index].end_point_x;
		conn_point_Y = serviceList[conn_index].end_point_y;
	}else if(conn_dao){
		conn_point_X = daoList[conn_index].end_point_x;
		conn_point_Y = daoList[conn_index].end_point_y;
	}
	
}

/**
 * document에서 받아온 값들을 list에 저장하는 함수
 */
function Value_List_Save(){
	// 각각 들어오는 check_package의 값에 따라서 classname을 따로 저장
	if(check_package == "Controller"){
		// class name이 중복되지 않고 null이 아니면 값을 list에 저장. 
		if(check_name == true && c_name != ""){
		

			draw_className += "Controller";
			gubun=1;
			controller = new element();
			controller.classname = draw_className;
			controller.valuename = draw_valueName;
			controller.methodname = draw_methodName;
			controller.selectvalue = draw_select_val;
			controller.selectmethod = draw_select_func;
			controller.connclassname = connectclass;
			controller.start_point_x = xpos;
			controller.start_point_y = ypos;
			controller.end_point_x = end_xpos;
			controller.end_point_y = end_ypos;
			
			//controllerList[con_cnt] = controller;
			
			//con_cnt++;
			EmitCanvas(gubun);
		}
	}else if(check_package == "Service"){
		if(check_name == true && c_name != ""){
			

			draw_className += "Service";
			gubun=2;	
			service = new element();
			service.classname = draw_className;
			service.valuename = draw_valueName;
			service.methodname = draw_methodName;
			service.selectvalue = draw_select_val;
			service.selectmethod = draw_select_func;
			service.connclassname = connectclass;
			service.start_point_x = xpos;
			service.start_point_y = ypos;
			service.end_point_x = end_xpos;
			service.end_point_y = end_ypos;
			
			//serviceList[ser_cnt] = service;
			
			//ser_cnt++;
			EmitCanvas(gubun);
		}
	}else if(check_package == "DAO"){
		if(check_name == true && c_name != ""){
			
		
			draw_className += "DAO";
			gubun=3;
			dao = new element();
			dao.classname = draw_className;
			dao.valuename = draw_valueName;
			dao.methodname = draw_methodName;
			dao.selectvalue = draw_select_val;
			dao.selectmethod = draw_select_func;
			dao.connclassname = connectclass;
			dao.start_point_x = xpos;
			dao.start_point_y = ypos;
			dao.end_point_x = end_xpos;
			dao.end_point_y = end_ypos;
			
			//daoList[dao_cnt] = dao;
			
			//dao_cnt++;
			EmitCanvas(gubun);
		}
	}else if(check_package == "mvc"){
		if(check_name == true && c_name != ""){
		
			controller = new element();
			service = new element();
			dao = new element();
			
			// controller 값을 list에 저장
			draw_className = c_name + "Controller";
			gubun=1;
			controller.classname = draw_className;
			controller.valuename = draw_valueName;
			controller.methodname = draw_methodName;
			controller.selectvalue = draw_select_val;
			controller.selectmethod = draw_select_func;
			controller.connclassname = connectclass;
			controller.start_point_x = xpos;
			controller.start_point_y = ypos;
			controller.end_point_x = end_xpos;
			controller.end_point_y = end_ypos;
			
			//controllerList[con_cnt] = controller;
			EmitCanvas(gubun);

			// service 값을 list에 저장
			xpos = xpos + 200;
			ypos = ypos + 200;
			Connect_SavePoint(draw_valueName.length, draw_methodName.length);
			
			connectclass = draw_className;
			draw_className = c_name + "Service";
			gubun=2;
			service.classname = draw_className;
			service.valuename = draw_valueName;
			service.methodname = draw_methodName;
			service.selectvalue = draw_select_val;
			service.selectmethod = draw_select_func;
			service.connclassname = connectclass;
			service.start_point_x = xpos;
			service.start_point_y = ypos;
			service.end_point_x = end_xpos;
			service.end_point_y = end_ypos;
			
			//serviceList[ser_cnt] = service;
			EmitCanvas(gubun);

			//dao 값을 list에 저장
			xpos = xpos + 200;
			ypos = ypos + 200;
			Connect_SavePoint(draw_valueName.length, draw_methodName.length);
			
			connectclass = draw_className;
			draw_className = c_name + "DAO";
			gubun=3;
			dao.classname = draw_className;
			dao.valuename = draw_valueName;
			dao.methodname = draw_methodName;
			dao.selectvalue = draw_select_val;
			dao.selectmethod = draw_select_func;
			dao.connclassname = connectclass;
			dao.start_point_x = xpos;
			dao.start_point_y = ypos;
			dao.end_point_x = end_xpos;
			dao.end_point_y = end_ypos;
			
			//daoList[dao_cnt] = dao;
			EmitCanvas(gubun);
			//con_cnt++;
			//ser_cnt++;
			//dao_cnt++;
		}
	}
}

function ValuesInit(){
	check_package = "";
	c_name = "";
	v_name = [];
	m_name = [];
	select_val = [];
	select_func = [];
	connectclass = "init";

	conn_index = -1;
	check_name = false;
	check_name_con = false;
	check_name_ser = false;
	check_name_dao = false;
	conn_ser = false;
	conn_dao = false;
	conn_con = false;
	
}


			//mvc_modal_modify.js
/**
 * 수정 button을 눌렀을 떄 호출되는 함수.
 */
function List_Modify(a){
	
	modify_class = a;
	
	modify_choice = true;
	Search_List_Modify();
	
	if(modify_con){	
		
		check_package = "Controller";
		
		document.getElementById("classname").value = controllerList[modify_index].classname;
		// value와 method의 개수만큼 form을 늘려줌. 
		for(var i=1;i<controllerList[modify_index].valuename.length;i++){
			AddValueForm();
		}
		for(var i=1;i<controllerList[modify_index].methodname.length;i++){
			AddMethodForm();
		}
		// form의 값을 설정해줌
		for(var i=0; i<val_count; i++){
			document.getElementById("valuename"+i).value = controllerList[modify_index].valuename[i];
			document.getElementById("select_value"+i).value = controllerList[modify_index].selectvalue[i];
		}
		for(var i=0; i<m_count; i++){
			document.getElementById("methodname"+i).value = controllerList[modify_index].methodname[i];
			document.getElementById("select_method"+i).value = controllerList[modify_index].selectmethod[i];
		}
		
		Dynamic_Connect_List();
		document.getElementById("connectclass").value = controllerList[modify_index].connclassname;
		
		xpos = controllerList[modify_index].start_point_x;
		ypos = controllerList[modify_index].start_point_y;
		
		// modal창을 불러옴
		$(document).ready(function(){
			$("#myModal").modal();
		});
		
	}else if(modify_ser){
		
		check_package = "Service";
		
		document.getElementById("classname").value = serviceList[modify_index].classname;
		// value와 method의 개수만큼 form을 늘려줌. 
		for(var i=1;i<serviceList[modify_index].valuename.length;i++){
			AddValueForm();
		}
		for(var i=1;i<serviceList[modify_index].methodname.length;i++){
			AddMethodForm();
		}
		
		// form의 값을 설정해줌
		for(var i=0; i<val_count; i++){
			document.getElementById("valuename"+i).value = serviceList[modify_index].valuename[i];
			document.getElementById("select_value"+i).value = serviceList[modify_index].selectvalue[i];
		}
		for(var i=0; i<m_count; i++){
			document.getElementById("methodname"+i).value = serviceList[modify_index].methodname[i];
			document.getElementById("select_method"+i).value = serviceList[modify_index].selectmethod[i];
		}
		
		Dynamic_Connect_List();
		document.getElementById("connectclass").value = serviceList[modify_index].connclassname;
		
		xpos = serviceList[modify_index].start_point_x;
		ypos = serviceList[modify_index].start_point_y;
		
		$(document).ready(function(){
			$("#myModal").modal();
		});
	}else if(modify_dao){

		check_package = "DAO";
		
		document.getElementById("classname").value = daoList[modify_index].classname;
		// value와 method의 개수만큼 form을 늘려줌. 
		for(var i=1;i<daoList[modify_index].valuename.length;i++){
			AddValueForm();
		}
		for(var i=1;i<daoList[modify_index].methodname.length;i++){
			AddMethodForm();
		}
		
		// form의 값을 설정해줌
		for(var i=0; i<val_count; i++){
			document.getElementById("valuename"+i).value = daoList[modify_index].valuename[i];
			document.getElementById("select_value"+i).value = daoList[modify_index].selectvalue[i];
		}
		for(var i=0; i<m_count; i++){
			document.getElementById("methodname"+i).value = daoList[modify_index].methodname[i];
			document.getElementById("select_method"+i).value = daoList[modify_index].selectmethod[i];
		}
		
		Dynamic_Connect_List();  
		document.getElementById("connectclass").value = daoList[modify_index].connclassname;
		
		xpos = daoList[modify_index].start_point_x;
		ypos = daoList[modify_index].start_point_y;
		
		$(document).ready(function(){
			$("#myModal").modal();
		});
	}
}

/**
 * 수정을 위한 탐색 함수
 */
function Search_List_Modify(){
	
	// controllerList 탐색
	for(var i=0;i<controllerList.length;i++){
		if(modify_class == controllerList[i].classname){
			modify_index = i;
			modify_con = true;
			break;
		}else{
			modify_con = false;
		}
	}
	
	// serviceList 탐색
	for(var i=0;i<serviceList.length;i++){
		if(modify_class == serviceList[i].classname){
			modify_index = i;
			modify_ser = true;
			break;
		}else{
			modify_ser = false;
		}
	}
	
	// daoList 탐색
	for(var i=0;i<daoList.length;i++){
		if(modify_class == daoList[i].classname){
			modify_index = i;
			modify_dao = true;
			break;
		}else{
			modify_dao = false;
		}
	}
}

/**
 * 연결된 class들을 찾아서 이름을 바꾸어주는 함수.
 */
function Modify_Conn_List(){
	
	m_conn_list=[]; //연결된 class들의 리스트
	m_conn_size=0;
	//연결된 class 구조체
	function m_conn_class(){
		var m_conn_gb=0; //어떤것(controller or service or..etc...)에 연결된클래스이름을 수정하는지
		var m_conn_cl=''; //연결된 클래스 이름을 수정해야하는 클래스 이름 
		var m_conn_idx=0; //연결된 클래스 이름을 수정해야하는 클래스 인덱스 
	}
	var m_conn_c; //연결된 클래스 구조체 변수
	// controllerList의 connectclass를 탐색
	for(var i=0;i<controllerList.length;i++){
		if(modify_class == controllerList[i].connclassname){
			if(check_package == "Service"){
				//controllerList[i].connclassname = serviceList[modify_index].classname;
				m_conn_c=new m_conn_class();
				m_conn_c.m_conn_gb=1;
				m_conn_c.m_conn_idx=i;
				m_conn_c.m_conn_cl=controllerList[i].classname;
				m_conn_list[m_conn_size]=m_conn_c;
				m_conn_size++;
			}else if(check_package == "DAO"){
				//controllerList[i].connclassname = dao[modify_index].classname;
				m_conn_c=new m_conn_class();
				m_conn_c.m_conn_gb=1;
				m_conn_c.m_conn_idx=i;
				m_conn_c.m_conn_cl=controllerList[i].classname;
				m_conn_list[m_conn_size]=m_conn_c;
				m_conn_size++;
			}
		}
	}
	
	// serviceList의 connectclass를 탐색
	for(var i=0;i<serviceList.length;i++){
		if(modify_class == serviceList[i].connclassname){
			if(check_package == "Controller"){
				//serviceList[i].connclassname = controllerList[modify_index].classname;
				m_conn_c=new m_conn_class();
				m_conn_c.m_conn_gb=2;
				m_conn_c.m_conn_idx=i;
				m_conn_c.m_conn_cl=serviceList[i].classname;
				m_conn_list[m_conn_size]=m_conn_c;
				m_conn_size++;
			}else if(check_package == "DAO"){
				//serviceList[i].connclassname = daoList[modify_index].classname;
				m_conn_c=new m_conn_class();
				m_conn_c.m_conn_gb=2;
				m_conn_c.m_conn_idx=i;
				m_conn_c.m_conn_cl=serviceList[i].classname;
				m_conn_list[m_conn_size]=m_conn_c;
				m_conn_size++;
			}
		}
	}
	
	// daoList의 connectclass를 탐색
	for(var i=0;i<daoList.length;i++){
		if(modify_class == daoList[i].connclassname){
			if(check_package == "Controller"){
				//daoList[i].connclassname = controllerList[modify_index].classname;
				m_conn_c=new m_conn_class();
				m_conn_c.m_conn_gb=3;
				m_conn_c.m_conn_idx=i;
				m_conn_c.m_conn_cl=daoList[i].classname;
				m_conn_list[m_conn_size]=m_conn_c;
				m_conn_size++;
			}else if(check_package == "Service"){
				//daoList[i].connclassname = serviceList[modify_index].classname;
				m_conn_c=new m_conn_class();
				m_conn_c.m_conn_gb=3;
				m_conn_c.m_conn_idx=i;
				m_conn_c.m_conn_cl=daoList[i].classname;
				m_conn_list[m_conn_size]=m_conn_c;
				m_conn_size++;
			}
		}
	}
}

/**
 * 수정할 때 classname이 중복되지 않게 check하기 위한 함수.
 */
function Duplication_Check_Modify(){
	if(check_package == "Controller"){
		for(var i=0;i<controllerList.length;i++){
			if(controllerList[i].classname != document.getElementById("classname").value){
				c_name = document.getElementById("classname").value;
				check_name = true;
			}else{
				if(modify_index == i){
					c_name = document.getElementById("classname").value;
					check_name = true;
				}else{
					alert("Controller의 Name이 중복 됩니다.");
					check_name = false;
					break;
				}
			}
		}
	}else if(check_package == "Service"){
		for(var i=0;i<serviceList.length;i++){
			if(serviceList[i].classname != document.getElementById("classname").value){
				c_name = document.getElementById("classname").value;
				check_name = true;
			}else{
				if(modify_index == i){
					c_name = document.getElementById("classname").value;
					check_name = true;
				}else{
					alert("Service의 Name이 중복 됩니다.");
					check_name = false;
					break;
				}
			}
		}
	}else if(check_package == "DAO"){
		for(var i=0;i<daoList.length;i++){
			if(daoList[i].classname != document.getElementById("classname").value){
				c_name = document.getElementById("classname").value;
				check_name = true;
			}else{
				if(modify_index == i){
					c_name = document.getElementById("classname").value;
					check_name = true;
				}else{
					alert("DAO의 Name이 중복 됩니다.");
					check_name = false;
					break;
				}
			}
		}
	}
}

/**
 * 수정된 값을 list에 저장하는 함수.
 */
function Modify_Value_List_Save(){
	// 각각 들어오는 check_package의 값에 따라서 classname을 따로 저장
	if(check_package == "Controller"){
		// class name이 중복되지 않고 null이 아니면 값을 list에 저장. 
		if(check_name == true && c_name != ""){
			
			
			gubun=1;
			controller = new element();
			controller.classname = draw_className;
			controller.valuename = draw_valueName;
			controller.methodname = draw_methodName;
			controller.selectvalue = draw_select_val;
			controller.selectmethod = draw_select_func;
			controller.connclassname = connectclass;
			controller.start_point_x = controllerList[modify_index].start_point_x;
			controller.start_point_y = controllerList[modify_index].start_point_y;
			controller.end_point_x = end_xpos;
			controller.end_point_y = end_ypos;
			
			//controllerList[modify_index] = controller;
			Modify_Conn_List();
			EmitModifyCanvas(gubun);
			
		}
	}else if(check_package == "Service"){
		if(check_name == true && c_name != ""){
			
			
			gubun=2;	
			service = new element();
			service.classname = draw_className;
			service.valuename = draw_valueName;
			service.methodname = draw_methodName;
			service.selectvalue = draw_select_val;
			service.selectmethod = draw_select_func;
			service.connclassname = connectclass;
			service.start_point_x = serviceList[modify_index].start_point_x;
			service.start_point_y = serviceList[modify_index].start_point_y;
			service.end_point_x = end_xpos;
			service.end_point_y = end_ypos;
			
			//serviceList[modify_index] = service;
			Modify_Conn_List();
			EmitModifyCanvas(gubun);
		}
	}else if(check_package == "DAO"){
		if(check_name == true && c_name != ""){
			
			
			gubun=3;
			dao = new element();
			dao.classname = draw_className;
			dao.valuename = draw_valueName;
			dao.methodname = draw_methodName;
			dao.selectvalue = draw_select_val;
			dao.selectmethod = draw_select_func;
			dao.connclassname = connectclass;
			dao.start_point_x = daoList[modify_index].start_point_x;
			dao.start_point_y = daoList[modify_index].start_point_y;
			dao.end_point_x = end_xpos;
			dao.end_point_y = end_ypos;
			
			//daoList[modify_index] = dao;
			Modify_Conn_List();
			EmitModifyCanvas(gubun);
		}
	}
}

function ModifyInit(){
	modify_class = "";
	modify_choice = false;
	modify_con = false;
	modify_ser = false;
	modify_dao = false;
	modify_index = -1;
}





			//mvc_modal_delete.js

/**
 * 삭제 button을 눌렀을 때 호출되는 함수.
 */
function List_Delete(a){
	
	delete_class = a;
	Search_List_Delete();
	
	if(delete_con){
		check_package = "Controller";
		gubun=1;
		Delete_Conn_List();
		EmitDeleteCanvas();
		//Delete_Value_List_Save();
		/*if(con_cnt > 0){
			con_cnt--;
		}*/
	}else if(delete_ser){
		check_package = "Service";
		gubun=2;
		Delete_Conn_List();
		EmitDeleteCanvas();
		//Delete_Value_List_Save();
		/*if(ser_cnt > 0){
			ser_cnt--;
		}*/
	}else if(delete_dao){
		check_package = "DAO";
		gubun=3;
		Delete_Conn_List();
		EmitDeleteCanvas();
		//Delete_Value_List_Save();
		/*if(dao_cnt > 0){
			dao_cnt--;
		}*/
	}
	
	//Erase_Canvas();
	//Draw_AllList();
	
	//MVC_List_View();
	
	ValuesInit();
	ModifyInit();
	DeleteInit();
	DrawInit();
	FormInit();
}

/**
 * 삭제할 index를 찾는 함수.
 */
function Search_List_Delete(){
	// controllerList 탐색
	for(var i=0;i<controllerList.length;i++){
		if(delete_class == controllerList[i].classname){
			delete_index = i;
			delete_con = true;
			break;
		}else{
			delete_con = false;
		}
	}
	
	// serviceList 탐색
	for(var i=0;i<serviceList.length;i++){
		if(delete_class == serviceList[i].classname){
			delete_index = i;
			delete_ser = true;
			break;
		}else{
			delete_ser = false;
		}
	}
	
	// daoList 탐색
	for(var i=0;i<daoList.length;i++){
		if(delete_class == daoList[i].classname){
			delete_index = i;
			delete_dao = true;
			break;
		}else{
			delete_dao = false;
		}
	}
}

/**
 * 찾은 index를 삭제하고 index를 당기는 함수.
 */
/*
function Delete_Value_List_Save(){
	if(check_package == "Controller"){
		controllerList.splice(delete_index,1);
	}else if(check_package == "Service"){
		serviceList.splice(delete_index,1);
	}else if(check_package == "DAO"){
		daoList.splice(delete_index,1);
	}
}*/

function Delete_Conn_List(){
	
	d_conn_list=[]; //연결된 class들의 리스트
	d_conn_size=0;
	//연결된 class 구조체
	function d_conn_class(){
		var d_conn_gb=0; //어떤것(controller or service or..etc...)에 연결된클래스이름을 삭제하는지
		var d_conn_cl=''; //연결된 클래스 이름을 삭제해야하는 클래스 이름 
		var d_conn_idx=0; //연결된 클래스 이름을 삭제해야하는 클래스 인덱스 
	}
	var d_conn_c; //연결된 클래스 구조체 변수

	// controllerList의 connectclass를 탐색
	for(var i=0;i<controllerList.length;i++){
		if(delete_class == controllerList[i].connclassname){
			if(check_package == "Service"){
				//controllerList[i].connclassname = "init";
				d_conn_c=new d_conn_class();
				d_conn_c.d_conn_gb=1;
				d_conn_c.d_conn_idx=i;
				d_conn_c.d_conn_cl=controllerList[i].classname;
				d_conn_list[d_conn_size]=d_conn_c;
				d_conn_size++;
			}else if(check_package == "DAO"){
				//controllerList[i].connclassname = "init";
				d_conn_c=new d_conn_class();
				d_conn_c.d_conn_gb=1;
				d_conn_c.d_conn_idx=i;
				d_conn_c.d_conn_cl=controllerList[i].classname;
				d_conn_list[d_conn_size]=d_conn_c;
				d_conn_size++;
			}
		}
	}
	
	// serviceList의 connectclass를 탐색
	for(var i=0;i<serviceList.length;i++){
		if(delete_class == serviceList[i].connclassname){
			if(check_package == "Controller"){
				//serviceList[i].connclassname = "init";
				d_conn_c=new d_conn_class();
				d_conn_c.d_conn_gb=2;
				d_conn_c.d_conn_idx=i;
				d_conn_c.d_conn_cl=serviceList[i].classname;
				d_conn_list[d_conn_size]=d_conn_c;
				d_conn_size++;
			}else if(check_package == "DAO"){
				//serviceList[i].connclassname = "init";
				d_conn_c=new d_conn_class();
				d_conn_c.d_conn_gb=2;
				d_conn_c.d_conn_idx=i;
				d_conn_c.d_conn_cl=serviceList[i].classname;
				d_conn_list[d_conn_size]=d_conn_c;
				d_conn_size++;
			}
		}
	}
	
	// daoList의 connectclass를 탐색
	for(var i=0;i<daoList.length;i++){
		if(delete_class == daoList[i].connclassname){
			if(check_package == "Controller"){
				//daoList[i].connclassname = "init";
				d_conn_c=new d_conn_class();
				d_conn_c.d_conn_gb=3;
				d_conn_c.d_conn_idx=i;
				d_conn_c.d_conn_cl=daoList[i].classname;
				d_conn_list[d_conn_size]=d_conn_c;
				d_conn_size++;
			}else if(check_package == "Service"){
				//daoList[i].connclassname = "init";
				d_conn_c=new d_conn_class();
				d_conn_c.d_conn_gb=3;
				d_conn_c.d_conn_idx=i;
				d_conn_c.d_conn_cl=daoList[i].classname;
				d_conn_list[d_conn_size]=d_conn_c;
				d_conn_size++;
			}
		}
	}
}

/**
 * 사용한 값들을 초기화하는 함수.
 */
function DeleteInit(){
	delete_class = "";
	delete_con = false;
	delete_ser = false;
	delete_dao = false;
	delete_index = -1;
}







			//mvc_modal.js
// 각 input box의 id값을 가져와서 배열에 저장하고 canvas를 그려주는 함수. modal창의 ok button을 누르면 실행됨.
function OnOK() {
	
	if(!modify_choice){
		
		Connect_SavePoint(val_count, m_count);

		Duplication_Check();
		Call_Value();
		
		Value_List_Save();
		
		//Draw_AllList();
		//MVC_List_View();
		
		ValuesInit();
		ModifyInit();
		DeleteInit();
		DrawInit();
		FormInit();
		
	}else{
		
		Connect_SavePoint(val_count, m_count);

		Duplication_Check_Modify();
		Call_Value();
		
		Modify_Value_List_Save();
		
		//Draw_AllList();
		//MVC_List_View();
		
		ValuesInit();
		ModifyInit();
		DeleteInit();
		DrawInit();
		FormInit();
	}
}

function OnCancel(){
	ValuesInit();
	ModifyInit();
	DeleteInit();
	DrawInit();
	FormInit();
}





			//draw.js

/**
 * class를 그리기 위한 함수.
 */
function DrawClass() {
	var i=0;
	var j=0;
	
	// class의 크기에 맞추어서 사각형을 그려줌.
	context.strokeRect(xpos, ypos, base_xpos, base_ypos + 20*(cname_num + val_num) + 15*m_num);
	
	// classname 배열에 마지막에 저장된 class name을 출력
	context.fillText(draw_className, xpos + 10, ypos + 15 * cname_num);
	
	// 변수를 그려줌.
	for (i = 0; i < val_num; i++) {
		if(draw_select_val[i] == "init"){
			context.fillText(draw_valueName[i], xpos+10, ypos+20 * cname_num + 15*(i+1));
		}else{
			context.fillText(draw_select_val[i] + " " + draw_valueName[i], xpos+10, ypos+20 * cname_num + 15*(i+1));
		}
	}
	
	// 메소드를 그려줌.
	for (j = 0; j < m_num; j++) {
		if(draw_select_func[j] == "init"){
			context.fillText(draw_methodName[j], xpos+10, ypos+20 * cname_num + 15*(i+1) + 15*(j+1));
		}else{
			context.fillText(draw_select_func[j] + " " + draw_methodName[j], xpos+10, ypos+20 * cname_num + 15*(i+1) + 15*(j+1));
		}
	}
	
	DrawLine();
}

/**
 * class의 이름, 변수, 메서드 영역을 구별하기 위한 선을 그려주는 함수.
 */
function DrawLine() {
	context.beginPath();
	context.moveTo(xpos, ypos + 20 * cname_num);
	context.lineTo(xpos + base_xpos, ypos + 20 * cname_num);

	if (val_num != 0) {
		context.moveTo(xpos, 15 + ypos + 15*(val_num+1));
		context.lineTo(xpos + base_xpos, 15 + ypos + 15*(val_num+1));
	}
	context.stroke();
}

/**
 * class의 좌표를 이어주기 위한 함수. ( list에 저장하기 전에 DrawClass()를 사용하기 전에 사용.)
 */

function Connect_SavePoint(valNum, mNum){
	width = xpos + base_xpos;
	height = ypos + base_ypos;
	
	end_xpos = width;
	end_ypos = height + 20*(1 + valNum) + 15*mNum;
}
/**
 * class와 class를 연결해주는 선을 그리는 함수
 */
function DrawConnect(){
	
	context.beginPath();
	context.moveTo(xpos, ypos);
	context.lineTo(conn_point_X, conn_point_Y);
	context.stroke();
}

/**
 * canvas의 내용을 전부 지움.
 */
function Erase_Canvas(){
	context.clearRect(0,0,1600,900);	
}

/**
 * list의 모든 클래스들을 그려주는 함수.
 */
function Draw_AllList(){
	Erase_Canvas();
	
	context.beginPath();
	
	for(var i=0;i<controllerList.length;i++){
		
		draw_className = controllerList[i].classname;
		
		val_num = controllerList[i].valuename.length;
		m_num = controllerList[i].methodname.length;
		
		draw_valueName = controllerList[i].valuename;
		draw_methodName = controllerList[i].methodname;
		draw_select_val = controllerList[i].selectvalue;
		draw_select_func = controllerList[i].selectmethod;
		
		connectclass = controllerList[i].connclassname;
		
		xpos = controllerList[i].start_point_x;
		ypos = controllerList[i].start_point_y;
		

		//Connect_SavePoint(val_num, m_num);
		
		

		if(controllerList[i].connclassname != "init"){
		
			All_Draw_Connect_Line();
			DrawConnect();
			DrawClass();
		}else{
			DrawClass();
		}
		
	}
	
	for(var i=0;i<serviceList.length;i++){
		
		draw_className = serviceList[i].classname;
		
		val_num = serviceList[i].valuename.length;
		m_num = serviceList[i].methodname.length;
		draw_valueName = serviceList[i].valuename;
		draw_methodName = serviceList[i].methodname;
		draw_select_val = serviceList[i].selectvalue;
		draw_select_func = serviceList[i].selectmethod;
		
		connectclass = serviceList[i].connclassname;
		
		xpos = serviceList[i].start_point_x;
		ypos = serviceList[i].start_point_y;
		
		Connect_SavePoint(val_num, m_num);

		if(serviceList[i].connclassname != "init"){
		
			All_Draw_Connect_Line();
			DrawConnect();
			DrawClass();
		}else{
			DrawClass();
		}
	}
	
	for(var i=0;i<daoList.length;i++){

		draw_className = daoList[i].classname;
		
		val_num = daoList[i].valuename.length;
		m_num = daoList[i].methodname.length;
		
		draw_valueName = daoList[i].valuename;
		draw_methodName = daoList[i].methodname;
		draw_select_val = daoList[i].selectvalue;
		draw_select_func = daoList[i].selectmethod;
		
		connectclass = daoList[i].connclassname;
		
		xpos = daoList[i].start_point_x;
		ypos = daoList[i].start_point_y;
	
		Connect_SavePoint(val_num, m_num);

		if(daoList[i].connclassname != "init"){
		
			All_Draw_Connect_Line();
			DrawConnect();
			DrawClass();
		}else{
			DrawClass();
		}
	}

	context.rect(0, 0, 1600, 900);
	context.stroke();
	context.closePath();
	
}


/**
 * 변수들을 초기화 해주는 함수.
 */
function DrawInit(){
	xpos = 0;
	ypos = 0;
	cname_num = 1;
	val_num = 1;
	m_num = 1;
	width = 0;
	height = 0;
	end_xpos = 0;
	end_ypos = 0;
	conn_point_X = 0;
	conn_point_Y = 0;
	
	draw_className = "";
	draw_valueName = [];
	draw_methodName = [];
	draw_select_val = [];
	draw_select_func = [];
}
     







	
    $(document).ready(function(){



	//버튼누르면 프로젝트파일생성하라고 서버에 emit 
	$('body > button').click(function (){
                  
                socket.emit('createpj');       // 소켓 이벤트 발생
              
         });

	






	





        // 이벤트 연결

        canvas.onmousedown = function(event){
	    context.beginPath();
            isDown = true;      // 눌렀다
	
            point= new Point(event, this);      // 현재 마우스 위치를 기록
	    xpos=point.x;
	    ypos=point.y;
		
	    if(isDown&&list_click){

			Dynamic_Connect_List();
			$("#myModal").modal();
			list_click = false;
            
       


            }
	context.stroke();

        };

        canvas.onmouseup = function(){ isDown = false; };

        canvas.onmousemove = function(event) {

           isDown =false;

        };


// 캔버스 안에 그려줄 화면 크기
context.beginPath();
context.rect(0, 0, 1200, 1200);
context.stroke();
     
//서버에서 이미 그려진 캔버스데이터
//나중에 함수로..
var creator=false;
<% var m=0;
  var n=0;

if(canvaslist.length==0){%>   //방생성자면 
//기본 mvc클래스 그려주기
	var creator=true;
	context.beginPath();
	
			//mvc.js
	// controller의 값들을 변수에 저장.
	gubun=1;
	xpos = 50;
	ypos = 50;
	draw_className = "ExamController";
	draw_valueName[0] = "value1";
	draw_valueName[1] = "value2";
	draw_select_val[0] = "int";
	draw_select_val[1] = "String";
	val_num  = draw_valueName.length;
	draw_methodName[0] = "method1";
	draw_methodName[1] = "method2";
	draw_select_func[0] = "void";
	draw_select_func[1] = "int";
	m_num  = draw_methodName.length;
	connectclass = "init";
	
	Connect_SavePoint(val_num, m_num);
	
	
	// element에 초기값을 저장함.
	controller = new element();
	controller.classname = draw_className;
	controller.valuename = draw_valueName;
	controller.methodname = draw_methodName;
	controller.selectvalue = draw_select_val;
	controller.selectmethod = draw_select_func;
	controller.connclassname = connectclass;
	controller.start_point_x = xpos;
	controller.start_point_y = ypos;
	controller.end_point_x = end_xpos;
	controller.end_point_y = end_ypos;
	
	//controllerList[con_cnt] = controller;
	//con_cnt++;
	EmitCanvas(gubun);
	
	gubun=2;
	xpos = 250;
	ypos = 250;
	draw_className = "ExamService";
	draw_valueName[0] = "value1";
	draw_valueName[1] = "value2";
	draw_select_val[0] = "int";
	draw_select_val[1] = "String";
	val_num  = draw_valueName.length;
	draw_methodName[0] = "method1";
	draw_methodName[1] = "method2";
	draw_select_func[0] = "void";
	draw_select_func[1] = "int";
	m_num  = draw_methodName.length;
	connectclass = "ExamController";
	
	Connect_SavePoint(val_num, m_num);

	service = new element();
	service.classname = draw_className;
	service.valuename = draw_valueName;
	service.methodname = draw_methodName;
	service.selectvalue = draw_select_val;
	service.selectmethod = draw_select_func;
	service.connclassname = connectclass;
	service.start_point_x = xpos;
	service.start_point_y = ypos;
	service.end_point_x = end_xpos;
	service.end_point_y = end_ypos;
	
	//serviceList[0] = service;
	check_package = "Controller";
	EmitCanvas(gubun);
	index = 0;

	//ser_cnt++;
	
	gubun=3;
	xpos = 450;
	ypos = 450;
	draw_className = "ExamDAO";
	draw_valueName[0] = "value1";
	draw_valueName[1] = "value2";
	draw_select_val[0] = "int";
	draw_select_val[1] = "String";
	val_num  = draw_valueName.length;
	draw_methodName[0] = "method1";
	draw_methodName[1] = "method2";
	draw_select_func [0] = "void";
	draw_select_func [1] = "int";
	m_num  = draw_methodName.length;
	connectclass = "ExamService";
	
	Connect_SavePoint(val_num, m_num);

	dao = new element();
	dao.classname = draw_className;
	dao.valuename = draw_valueName;
	dao.methodname = draw_methodName;
	dao.selectvalue = draw_select_val;
	dao.selectmethod = draw_select_func;
	dao.connclassname = connectclass;
	dao.start_point_x = xpos;
	dao.start_point_y = ypos;
	dao.end_point_x = end_xpos;
	dao.end_point_y = end_ypos;
	
	//daoList[0] = dao;
	EmitCanvas(gubun);
	check_package = "Service";
	index = 0;

	//dao_cnt++;
	
	context.beginPath();
	
	// 캔버스 안에 그려줄 화면 크기
	context.rect(0, 0, 1200, 1200);
	
	//Draw_AllList();
	
	context.stroke();

	context.closePath();
	
	MVC_List_View();
	
	DeleteInit();
	ModifyInit();
	ValuesInit();
	DrawInit();
	FormInit();
	
	


<%}else{
	for(var k=0; k<canvaslist.length;k++){
		if(canvaslist[k].gb==1){%>
			controllerList[con_cnt] =  <%- JSON.stringify(canvaslist[k].class)%>;		
			con_cnt++;
		<%}else if(canvaslist[k].gb==2){%>
			serviceList[ser_cnt] = <%- JSON.stringify(canvaslist[k].class)%>;		
			ser_cnt++;
		<%}else if(canvaslist[k].gb==3){%>
			daoList[dao_cnt] = <%- JSON.stringify(canvaslist[k].class)%>;			
			dao_cnt++;
		<%}%>	
	
       	 
		context.beginPath();
            
	
		Draw_AllList();
	
		context.stroke();

		MVC_List_View();
	
<%	}
}%>


//여기까지 이미 작성된 캔버스 그려주기.
	





	

//캔버스 그려주기
     socket.on('line', function(data){
	
	if(data.gb==1){
		controllerList[con_cnt] = data.class;			
		con_cnt++;
	}else if(data.gb==2){
		serviceList[ser_cnt] = data.class;			
		ser_cnt++;
	}else if(data.gb==3){
		daoList[dao_cnt] = data.class;			
		dao_cnt++;
	}
	
        //context.strokeStyle = data.color;
	context.beginPath();
            
	Draw_AllList();
	
	
	context.stroke();

	MVC_List_View();
	
	DeleteInit();
	ModifyInit();
	ValuesInit();
	DrawInit();
	FormInit();

        });


//수정된 캔버스 그려주기
     socket.on('mod_line', function(data){

	// 연결된 class 이름을 바꾸어주는 함수.
	function mod_conn(conn_c){
		if(conn_c.m_conn_gb==1){
			controllerList[conn_c.m_conn_idx].connclassname=data.class.classname;
			alert('연결바꿀클래스'+controllerList[conn_c.m_conn_idx].classname+'연결된거바꾸는 이름:'+data.class.classname);
		}else if(conn_c.m_conn_gb==2){
			serviceList[conn_c.m_conn_idx].connclassname=data.class.classname;
			alert('연결바꿀클래스'+serviceList[conn_c.m_conn_idx].classname+'연결된거바꾸는 이름:'+data.class.classname);
		}else if(conn_c.m_conn_gb==3){
			daoList[conn_c.m_conn_idx].connclassname=data.class.classname;
			alert('연결바꿀클래스'+daoList[conn_c.m_conn_idx].classname+'연결된거바꾸는 이름:'+data.class.classname);
		}

	}
	if(data.gb==1){
		controllerList[data.m_idx] = data.class;
					
		
	}else if(data.gb==2){
		serviceList[data.m_idx] = data.class;		
		
	}else if(data.gb==3){
		daoList[data.m_idx] = data.class;			
		
	}

	for(var i=0;i<data.m_conn_list.length; i++){
		mod_conn(data.m_conn_list[i]);
	}
	
        //context.strokeStyle = data.color;
	context.beginPath();
            
	Draw_AllList();
	
	
	context.stroke();

	MVC_List_View();
	
	DeleteInit();
	ModifyInit();
	ValuesInit();
	DrawInit();
	FormInit();

        });
        


//삭제후 캔버스 그려주기
     socket.on('del_line', function(data){

	// 연결된 class 이름을 "init"으로 바꾸어주는 함수.
	function del_conn(conn_c){
		if(conn_c.d_conn_gb==1){
			controllerList[conn_c.d_conn_idx].connclassname="init";
		}else if(conn_c.d_conn_gb==2){
			serviceList[conn_c.d_conn_idx].connclassname="init";
		}else if(conn_c.d_conn_gb==3){
			daoList[conn_c.d_conn_idx].connclassname="init";
		}

	}
	if(data.gb==1){
		controllerList.splice(data.d_idx,1);
		if(con_cnt > 0){
			con_cnt--;
		}
					
		
	}else if(data.gb==2){
		serviceList.splice(data.d_idx,1);	
		
	}else if(data.gb==3){
		daoList.splice(data.d_idx,1);
		if(ser_cnt > 0){
			ser_cnt--;
		}			
		
	}

	for(var i=0;i<data.d_conn_list.length; i++){
		del_conn(data.d_conn_list[i]);
	}
	
        //context.strokeStyle = data.color;
	context.beginPath();
        
	Erase_Canvas();    
	Draw_AllList();
	
	
	context.stroke();

	MVC_List_View();
	
	DeleteInit();
	ModifyInit();
	ValuesInit();
	DrawInit();
	FormInit();

        });
        


    });



    </script>
















			<br/>
			<br/>
			<br/>
			<br/>
			
	
			<div class="chat_css col-md-3">
			<table border="1px ">
				<div class="chatContent" style = "overflow:scroll; overflow-x:hidden">
					<div id="chatContent" >

					</div>
				</div>
				<div class="insert_css">
					<input id="chatName" value="" readonly="readonly"/>
					방:<input id="room" value="" readonly="readonly"/>
					 <input id="chatMessage" type="text"  />
					메시지 입력:<button id="chatButton">Button</button>
				</div>


			</table>
		</div>
	
	
	
	
		<input type="button" value="보이기" id="divView"/>		
	<div id = "p_list">
		참여자 목록
		<div id="participant">
			
		</div>
		
		<input type="button" id="addmail" value="추가"/>
		
		
		<br/>
		<form id="maillist" name="maillist">
		
		</form>
		
		
		<input type="button" value="메일 보내기  "id="sendmail"/>
																	
	</div>	
	
</body>
</html>
